<?xml version="1.0"?>
<database name="zed"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd"
          namespace="SprykerFeature\Zed\ProductOption\Persistence\Propel"
          package="vendor.spryker.spryker.Bundles.ProductOption.src.SprykerFeature.Zed.ProductOption.Persistence.Propel">

    <!-- Option Type -->
    <table name="spy_option_type" idMethod="native" allowPkInsert="true" phpName="SpyOptionType">
        <column name="id_option_type" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="import_key" type="VARCHAR" />
        <column name="fk_tax_set" type="INTEGER" required="false" />

        <unique>
            <unique-column name="import_key" />
        </unique>
        <foreign-key foreignTable="spy_tax_set" onDelete="SETNULL">
            <reference local="fk_tax_set" foreign="id_tax_set" />
        </foreign-key>
    </table>

    <!-- Option Value -->
    <table name="spy_option_value" idMethod="native" allowPkInsert="true" phpName="SpyOptionValue">
        <column name="id_option_value" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="import_key" type="VARCHAR" />
        <column name="fk_option_type" type="INTEGER" required="true" />
        <column name="fk_option_value_price" type="INTEGER" required="false" />

        <unique>
            <unique-column name="import_key" />
        </unique>
        <foreign-key foreignTable="spy_option_type" onDelete="CASCADE">
            <reference local="fk_option_type" foreign="id_option_type" />
        </foreign-key>
        <foreign-key foreignTable="spy_option_value_price" onDelete="SETNULL">
            <reference local="fk_option_value_price" foreign="id_option_value_price" />
        </foreign-key>
    </table>

    <!-- Option Value Price -->
    <table name="spy_option_value_price" idMethod="native" allowPkInsert="true" phpName="SpyOptionValuePrice">
        <column name="id_option_value_price" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="price" required="true" type="INTEGER" />
    </table>

    <!-- Option Value Translation -->
    <table name="spy_option_value_translation" idMethod="native" allowPkInsert="true" phpName="SpyOptionValueTranslation">
        <column name="name" required="true" type="VARCHAR" />
        <column name="fk_option_value" type="INTEGER" primaryKey="true" />
        <column name="fk_locale" type="INTEGER" primaryKey="true" />

        <foreign-key foreignTable="spy_option_value" onDelete="CASCADE">
            <reference local="fk_option_value" foreign="id_option_value" />
        </foreign-key>
        <foreign-key foreignTable="spy_locale" onDelete="CASCADE">
            <reference local="fk_locale" foreign="id_locale" />
        </foreign-key>
    </table>

    <!-- Option Type Translation -->
    <table name="spy_option_type_translation" idMethod="native" allowPkInsert="true" phpName="SpyOptionTypeTranslation">
        <column name="name" required="true" type="VARCHAR" />
        <column name="fk_option_type" type="INTEGER" primaryKey="true" />
        <column name="fk_locale" type="INTEGER" primaryKey="true" />

        <foreign-key foreignTable="spy_option_type" onDelete="CASCADE">
            <reference local="fk_option_type" foreign="id_option_type" />
        </foreign-key>
        <foreign-key foreignTable="spy_locale" onDelete="CASCADE">
            <reference local="fk_locale" foreign="id_locale" />
        </foreign-key>
    </table>

    <!-- Product Option Type -->
    <table name="spy_product_option_type" idMethod="native" allowPkInsert="true" phpName="SpyProductOptionType">
        <column name="id_product_option_type" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="is_optional" type="INTEGER" required="true" />
        <column name="sequence" type="INTEGER" required="false" />
        <column name="fk_product" type="INTEGER" required="true" />
        <column name="fk_option_type" type="INTEGER" required="true" />

        <foreign-key foreignTable="spy_product" onDelete="CASCADE">
            <reference local="fk_product" foreign="id_product" />
        </foreign-key>
        <foreign-key foreignTable="spy_option_type"> <!-- prevent cascade delete -->
            <reference local="fk_option_type" foreign="id_option_type" />
        </foreign-key>
    </table>

    <!-- Product Option Value -->
    <table name="spy_product_option_value" idMethod="native" allowPkInsert="true" phpName="SpyProductOptionValue">
        <column name="id_product_option_value" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="sequence" type="INTEGER" required="false" />
        <column name="fk_product_option_type" type="INTEGER" required="true" />
        <column name="fk_option_value" type="INTEGER" required="true" />

        <foreign-key foreignTable="spy_product_option_type" onDelete="CASCADE">
            <reference local="fk_product_option_type" foreign="id_product_option_type" />
        </foreign-key>
        <foreign-key foreignTable="spy_option_value"> <!-- prevent cascade delete -->
            <reference local="fk_option_value" foreign="id_option_value" />
        </foreign-key>
    </table>

    <!-- Product Option Type Exclusion -->
    <table name="spy_product_option_type_exclusion" idMethod="native" allowPkInsert="true" phpName="SpyProductOptionTypeExclusion">
        <column name="fk_product_option_type_a" type="INTEGER" primaryKey="true" />
        <column name="fk_product_option_type_b" type="INTEGER" primaryKey="true" />

        <foreign-key foreignTable="spy_product_option_type" onDelete="CASCADE" >
            <reference local="fk_product_option_type_a" foreign="id_product_option_type" />
        </foreign-key>
        <foreign-key foreignTable="spy_product_option_type" onDelete="CASCADE">
            <reference local="fk_product_option_type_b" foreign="id_product_option_type" />
        </foreign-key>
    </table>

    <!-- Product Option Value Constraint -->
    <table name="spy_product_option_value_constraint" idMethod="native" allowPkInsert="true" phpName="SpyProductOptionValueConstraint">
        <column name="fk_product_option_value_a" type="INTEGER" primaryKey="true" />
        <column name="fk_product_option_value_b" type="INTEGER" primaryKey="true" />
        <column name="operator" type="VARCHAR" size="255" required="true" />

        <foreign-key foreignTable="spy_product_option_value" onDelete="CASCADE">
            <reference local="fk_product_option_value_a" foreign="id_product_option_value" />
        </foreign-key>
        <foreign-key foreignTable="spy_product_option_value" onDelete="CASCADE">
            <reference local="fk_product_option_value_b" foreign="id_product_option_value" />
        </foreign-key>
    </table>

    <!-- Configuration Preset -->
    <table name="spy_configuration_preset" idMethod="native" allowPkInsert="true" phpName="SpyConfigurationPreset">
        <column name="id_configuration_preset" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="is_default" type="BOOLEAN" required="true" />
        <column name="sequence" type="INTEGER" required="false" />
        <column name="fk_product" type="INTEGER" required="true" />

        <foreign-key foreignTable="spy_product" onDelete="CASCADE">
            <reference local="fk_product" foreign="id_product" />
        </foreign-key>
    </table>

    <!-- Configuration Preset Value -->
    <table name="spy_configuration_preset_value" idMethod="native" allowPkInsert="true" phpName="SpyConfigurationPresetValue">
        <column name="fk_configuration_preset" type="INTEGER" primaryKey="true" />
        <column name="fk_product_option_value" type="INTEGER" primaryKey="true" />

        <foreign-key foreignTable="spy_configuration_preset" onDelete="CASCADE">
            <reference local="fk_configuration_preset" foreign="id_configuration_preset" />
        </foreign-key>
        <foreign-key foreignTable="spy_product_option_value" onDelete="CASCADE">
            <reference local="fk_product_option_value" foreign="id_product_option_value" />
        </foreign-key>
    </table>

</database>

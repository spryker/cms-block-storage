{% extends '@Gui/Layout/layout.twig' %}

{% set widget_title = 'Manage Attributes for Product Abstract [' ~ productAbstract.sku  ~ ']' %}
{% block section_title %}{{ widget_title }}{% endblock %}

{% block action %}
    {{ viewActionButton(url('/product-management/view?id-product-abstract=' ~ productAbstract.idProductAbstract), 'View Product Abstract' | trans) }}
    {{ backActionButton(url('/product-management'), 'Back to List' | trans) }}
{% endblock %}

{% block content %}
    <div style="display: none" id="productAttributeValuesJson">
        {{ productAttributeValuesJson | raw }}
    </div>
    <div style="display: none" id="metaAttributesJson">
        {{ metaAttributesJson | raw }}
    </div>
    <div style="display: none" id="localesJson">
        {{ localesJson | raw }}
    </div>

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Add Attribute Key' } %}
        {% block widget_content %}
            <div>
                {{ form_start(attributeKeyForm, { 'attr': {'class': 'kv_autocomplete_form', 'id': 'attribute_form'} }) }}
                {{ form_errors(attributeKeyForm) }}
                {{ form_widget(attributeKeyForm) }}
                <input type="button" onclick="return false" class="btn btn-primary" value="{{ 'Add' | trans }}"  id="addButton" />
                {{ form_end(attributeKeyForm) }}
            </div>
        {% endblock %}
    {% endembed %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Attributes' } %}
        {% block widget_content %}
        <table class="table table-striped table-bordered table-hover gui-table-data" id="productAttributesTable" data-paging="false">
        <form id="attribute_values_form" method="post" class="kv_autocomplete_form" action="/product-attribute-gui/save">
            <input type="hidden" name="attribute_values_form[hidden_product_abstract_id]" id="attribute_values_form_hidden_product_abstract_id" value="{{ idProductAbstract }}" />
            <thead>
            <tr>
                <th>key</th>
                {% for localeCode,localeData in locales %}
                    {% if localeCode == '_' %}
                        <th>{{ 'default' }}</th>
                    {% else %}
                        <th>{{ localeCode }}</th>
                    {% endif %}
                {% endfor %}
                <th>action</th>
            </tr>
            </thead>
            <tbody>
            {% for localeCode,localeData in locales %}
                {% if productAttributeValues[localeCode] is defined %}
                    {% for key,value in productAttributeValues[localeCode] %}
                        {% set idAttribute = metaAttributes[key]['attribute_id'] %}
                        {% set allowInput = metaAttributes[key]['allow_input'] %}
                        {% set isSuper = metaAttributes[key]['is_super'] %}

                        {% set readOnly = '' %}
                        {% if isSuper %}
                            {% set readOnly = 'readonly="readonly"' %}
                        {% endif %}

                        <tr>
                            <td>
                                {% if isSuper %}
                                    <i>{{ key }}</i>
                                {% else %}
                                    {{ key }}
                                {% endif %}
                            </td>
                            {% for valueLocaleCode,localeData in productAttributeValues %}
                                {% set name = '[' ~ key ~ ']' %}
                                {% set id = key %}

                                {% if valueLocaleCode != '_' %}
                                    {% set name = name ~ '[' ~ valueLocaleCode ~ ']' %}
                                    {% set id = id ~ '_' ~ valueLocaleCode %}
                                {% endif %}

                                {% set inputName = 'attribute_values_form' ~ name  %}
                                {% set inputId = 'attribute_values_form_' ~ id  %}

                                {% if localeData[key] is defined %}
                                    <td>
                                        <input
                                                {{ readOnly }}
                                                id="{{ inputId }}"
                                                name="{{ inputName }}"
                                                type="text"
                                                class="spryker-form-autocomplete form-control ui-autocomplete-input kv_attribute_autocomplete"
                                                value="{{ localeData[key] }}"
                                                data-allow_input="{{ allowInput }}"
                                                data-is_super="{{ isSuper }}"
                                                data-attribute_key="{{ key }}"
                                                data-is_attribute_input
                                                data-id_attribute="{{ idAttribute }}"
                                                data-locale_code="{{ valueLocaleCode }}"
                                        /><span style="display: none">{{ localeData[key] }}</span>
                                    </td>
                                {% else %}
                                    <td>
                                        <input
                                                {{ readOnly }}
                                                id="{{ inputId }}"
                                                name="{{ inputName }}"
                                                type="text"
                                                class="spryker-form-autocomplete form-control ui-autocomplete-input kv_attribute_autocomplete"
                                                value=""
                                                data-allow_input="{{ allowInput }}"
                                                data-is_super="{{ isSuper }}"
                                                data-attribute_key="{{ key }}"
                                                data-is_attribute_input
                                                data-id_attribute="{{ idAttribute }}"
                                                data-locale_code="{{ valueLocaleCode }}"
                                        />
                                        <span style="display: none"></span>
                                    </td>
                                {% endif %}
                            {% endfor %}
                            <td>
                                {% if isSuper == false %}
                                    <a data-key="{{ key }}" href="#" class="btn btn-xs btn-outline btn-danger remove-item">Remove</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            {% endfor %}
            </tbody>
        </form>
        </table>
        {% endblock %}
    {% endembed %}

    <input type="button" class="btn btn-primary" value="{{ 'Save' | trans }}" id="saveButton" />

{% endblock %}

{% block footer_js %}
    {{ parent() }}
    <script src="/assets/js/spryker-zed-productattributegui-main.js"></script>
{% endblock %}
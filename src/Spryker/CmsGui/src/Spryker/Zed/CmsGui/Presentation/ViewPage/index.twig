{% extends '@Cms/Layout/layout.twig' %}

{% set widget_title = 'View pages' | trans %}

{% block head_title widget_title %}
{% block section_title widget_title %}

{% block action %}

    {% set redirectUrl = url('/cms-gui/view-page', {'id-cms-page' : cmsPage.fkPage }) %}
    {{ include ('@CmsGui/_template/activate-button.twig', { 'isActive': cmsPage.isActive, 'idCmsPage': cmsPage.fkPage }) }}

    {{ editActionButton(url('/cms-gui/edit-page', { 'id-cms-page': cmsPage.fkPage }), 'Edit page' | trans) }}
    {{ editActionButton(url('/cms-gui/create-glossary', {'id-cms-page': cmsPage.fkPage}), 'Edit placeholders' | trans) }}
    {% if cmsVersion is not null %}
        {{ viewActionButton(url('/cms-gui/version-page/history', {'id-cms-page': cmsPage.fkPage , 'redirect-url' : redirectUrl }), 'Version History' | trans) }}
    {% endif %}
    {{ backActionButton('/cms-gui/list-page', 'Back to CMS' | trans) }}
{% endblock %}

{% block content %}

    {% if cmsVersion is not null %}
        <div class="well">
            {% filter trans|raw %}
                <p><i class="fa fa-info-circle" aria-hidden="true"></i> You are viewing a published page. It was published
                    {% if cmsVersion.firstName is not null %}
                        by <b>{{ cmsVersion.firstName }} {{ cmsVersion.lastName }}</b>
                    {% endif %}
                    on <b>{{ cmsVersion.createdAt | formatDateTime }}</b>.</p>
                <p><i>Note: When editing a page you will be working on a draft, which you can then publish.</i></p>
            {% endfilter %}
        </div>
    {% endif %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'General information' }  %}
        {% block widget_content %}
            <p>
                <strong>{{ 'Is searchable:' | trans }}</strong> {{ cmsPage.isSearchable ? 'yes' : 'no' }}
            </p>

            <p>
                <strong>{{ 'Is active:' | trans }}</strong> {{ cmsPage.isActive ? 'yes' : 'no' }}
            </p>

            <p>
                <strong>{{ 'Template:' | trans }}</strong> {{ cmsPage.templateName }}
            </p>

            <p>
                <strong>{{ 'Valid from:' | trans }}</strong> {{ cmsPage.validFrom ? cmsPage.validFrom|date : 'n/a'|trans }}
            </p>

            <p>
                <strong>{{ 'Valid to:' | trans }}</strong> {{ cmsPage.validTo ? cmsPage.validTo|date : 'n/a'|trans }}
            </p>

        {% endblock %}
    {% endembed %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Urls' } %}
        {% block widget_content %}

            <table class="table">
                <tr>
                    <th>{{ "Name" | trans }}</th>
                    <th>{{ "Url" | trans }}</th>
                    <th>{{ "Locale" | trans }}</th>
                </tr>
                {% for pageAttribute in cmsPage.pageAttributes %}
                    <tr>
                        <td>{{ pageAttribute.name }}</td>
                        <td>{{ pageAttribute.url }}</td>
                        <td>{{ pageAttribute.localeName }}</td>
                    </tr>
                {% endfor %}
            </table>

        {% endblock %}
    {% endembed %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'SEO' } %}
        {% block widget_content %}

            <table class="table">
                <tr>
                    <th>{{ "Title" | trans }}</th>
                    <th>{{ "Keywords" | trans }}</th>
                    <th>{{ "Description" | trans }}</th>
                    <th>{{ "Locale" | trans }}</th>
                </tr>
                {% for pageMetaAttribute in cmsPage.metaAttributes %}
                    <tr>
                        <td>{{ pageMetaAttribute.metaTitle }}</td>
                        <td>{{ pageMetaAttribute.metaKeywords }}</td>
                        <td>{{ pageMetaAttribute.metaDescription }}</td>
                        <td>{{ pageMetaAttribute.localeName }}</td>
                    </tr>
                {% endfor %}
            </table>

        {% endblock %}
    {% endembed %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Placeholders' } %}
        {% block widget_content %}

            {% for glossaryAttribute in cmsGlossary.glossaryAttributes %}

                <h3>{{ glossaryAttribute.placeholder }}</h3>

                <p>
                    <strong>{{ 'Translation key:' | trans }}</strong> {{ glossaryAttribute.translationKey }}
                </p>

                {% for translation in glossaryAttribute.translations %}
                   {% embed '@Gui/Partials/localized-ibox.twig' with {'localeName': translation.localeName, 'collapsed': true , 'hasError': false} %}
                       {% block content %}
                           {{ translation.translation | raw }}
                       {% endblock %}
                   {% endembed %}
                {% endfor %}

            {% endfor %}

        {% endblock %}
    {% endembed %}


{% endblock %}

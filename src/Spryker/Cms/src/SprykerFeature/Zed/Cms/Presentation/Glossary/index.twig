{% extends '@Application/Layout/layout.twig' %}

{% block content %}

    <h4>
        {% if type == 'page' %}
            Page URL :
        {% elseif type == 'block' %}
            Block Name :
        {% endif %}
        {{ title }}
    </h4>
    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Page glossary mapping' } %}

            {% block widget_header_content %}

                <a href="/cms/" class="btn btn-sm btn-default">{{ 'Back to CMS' | trans }}</a>

            {% endblock %}

            {% block widget_content %}

                {% for form in forms %}
                    <hr style="border: 1px dashed #eee;">
                    {{ form_start(form, { 'attr': {'class': 'form_class_' ~ loop.index} }) }}
                    {{ form_errors(form) }}

                    <div class="row">
                        <div class="col-sm-2">
                            {{ form_label(form.placeholder) }}
                            {{ form_widget(form.placeholder) }}
                            {{ form_errors(form.placeholder) }}
                        </div>
                        <div class="col-sm-2">
                            {{ form_label(form.search_option) }}
                            {{ form_widget(form.search_option) }}
                            {{ form_errors(form.search_option) }}
                        </div>
                        <div class="col-sm-8">
                            {{ form_label(form.glossary_key) }}
                            {{ form_widget(form.glossary_key) }}
                            {{ form_errors(form.glossary_key) }}
                        </div>
                        <div class="col-sm-12" style="padding-top: 10px;">
                            {{ form_label(form.translation) }}
                            {{ form_errors(form.translation) }}
                            {{ form_widget(form.translation, {'attr' : { 'rows' : 5 }}) }}
                        </div>
                        <div class="col-sm-1" style="padding: 10px;">
                            <input type="submit" class="btn btn-primary" value="{{ 'Save' | trans }}" />
                        </div>
                        <div class="col-sm-10" style="padding: 10px;">
                            <div class="{{ 'waiting_' ~ loop.index }}" style="color:gray;font-weight: bold"></div>
                            <div class="{{ 'success_' ~ loop.index }}" style="color:green;font-weight: bold"></div>
                            <div class="{{ 'error_' ~ loop.index }}" style="color:red;font-weight: bold"></div>
                        </div>
                    </div>

                    {{ form_end(form) }}
                {% endfor %}

            {% endblock %}

    {% endembed %}

{% endblock %}

{% block footer_js %}
    {{ parent() }}
    <script>
        function postForm( $form, id, successCallback ){

            var values = {};
            $.each( $form.serializeArray(), function(i, field) {
                values[field.name] = field.value;
            });
            $.ajax({
                type        : $form.attr( 'method' ),
                url         : '?id-page={{ idPage }}&id-form=' + id,
                data        : values,
                success     : function(data) {
                    successCallback(data);
                }
            });
        }
        $(document).ready(function(){
            {% for form in forms %}
                $('.form_class_' + {{ loop.index }}).submit( function( e ){
                    e.preventDefault();
                    $('.waiting_' + {{ loop.index }}).text('Waiting ...');
                    $('.success_' + {{ loop.index }}).text('');
                    $('.error_' + {{ loop.index }}).text('');
                    postForm( $(this), {{ loop.index - 1 }},
                        function( response ){
                            $('.waiting_' + {{ loop.index }}).text('');
                            if(response.success != 'false'){
                                $('.success_' + {{ loop.index }}).text('Successfully added.');
                            }else{
                                $('.error_' + {{ loop.index }}).text(response.errorMessages);
                            }
                        });

                    return false;
                });
            {% endfor %}
        });
    </script>
{% endblock %}
